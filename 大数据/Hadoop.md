# Hadoop
## 什么是hadoop？
Hadoop 是一个开源软件框架，用于存储大量数据，并发处理/查询在具有多个商用硬件（即低成本硬件）节点的集群上的那些数据。
Hadoop主要包含以下内容：
## HDFS Hadoop分布式文件系统
HDFS 允许你以一种分布式和冗余的方式存储大量数据，它具有高容错、高可靠性、高可扩展性、高获得性、高吞吐率等特征。
#### Blocks
HDFS的Block块比一般单机文件系统大得多，默认为128M。HDFS的文件被拆分成block-sized的chunk，chunk作为独立单元存储。比Block小的文件不会占用整个Block，只会占据实际大小。例如， 如果一个文件大小为1M，则在HDFS中只会占用1M的空间，而不是128M。

**Blocks**抽象的好处：
block的拆分使得单个文件大小可以大于整个磁盘的容量，构成文件的Block可以分布在整个集群， 理论上，单个文件可以占据集群中所有机器的磁盘。 

- 高容错性
  - 数据自动保存多个副本。
  - 某一个副本丢失后，它能自动恢复。
- 适合批处理
  - 它是通过移动计算而不是移动数据。
  - 它会把数据位置暴露给计算框架
- 适合大数据处理
  - 处理数据达到GB,TB甚至PD
  - 能够处理百万规模以上的文件数量
  - 能够处理10k节点的规模
- 流式文件访问
  - 一次写入，多次读取，文件一旦写入不能修改，只能追加。
  - 它保证数据的一致性。
- 可构建在廉价的机器上
  - 它通过多副本机制，提高可靠性。
  - 它提供了容错和恢复机制

但是HDFS同样也有不适用的场景
- 低延时的数据访问 
- 大量小文件
- 多方读写，需要任意的文件修改
    - HDFS采用追加（append-only）的方式写入数据。不支持文件任意offset的修改。不支持多个写入器（writer）。
## MapReduce 分布式计算框架
它以分布式和并行的方式处理大量数据。MapReduce由两个阶段组成：Map和Reduce，用户只需要实现map()和reduce()两个函数，就可以实现分布式计算。

ex: 
1. 读取HDFS中的文件,将它处理成<k,v>的形式，然后输出。
2. 对输出的<k,v>进行分区，默认分为一个区
3. 对不同分区中进行排序（按照k）、分组。分组指的是相同key的value放到一个集合中。
Reduce过程
4. 多个map任务的输出，按照不同的分区，通过网络复制到不同的reduce节点上。
5. 对多个map的输出进行合并、排序，覆盖reduce函数，接受分组后的数据，实现业务逻辑后生成新的<k,v>输出，然后将新的输出写到HDFS里。
### Shuffle过程
![](../img/4.11.1.png)
![](../img/4.11.2.png)
Map端shuffle
1. 分区partition
2. 写入环形内存缓冲区Spill
3. 执行溢出写
    排序sort--->合并combiner--->生成溢出写文件
4. 归并merge
   1. merge是将所有的溢写文件归并到一个文件，结合上面所描述的combiner的作用范围，归并得到的文件内键值对有可能拥有相同的key，这个过程如果client设置过

Reduce端shuffle
1. 复制copy,使用HTTP的方式拉取数据
2. sort
3. 归并merge
   1. Reducer的输入文件。不断地merge后，最后会生成一个“最终文件”。这个最终文件可能在磁盘中也可能在内存中。当然我们希望它在内存中，直接作为reducer的输入，但默认情况下，这个文件是存放于磁盘中的。当reducer的输入文件已定，整个shuffle才最终结束。然后就是reducer执行，把结果存放到HDFS上。
4. reduce
## YARN 用于作业调度和集群资源管理的框架

## 运行Hadoop集群需要哪些守护进程？
DataNode,NameNode,TaskTracker和JobTracker。
- NameNode是Hadoop的大脑，主要负责管理系统上的分配块，还为客户提出请求时的数据提供特定地址。它还全权管理数据块的复制，它周期性地从集群中的每个Datanode接收心跳信号和块状态报告。接收到心跳信号意味着该Datanode节点工作正常。块状态报告包含了一个该Datanode上所有数据块的列表。
- 作为分布式文件系统的工作节点，BataNode有着以下作用
  - 负责文件系统或者客户端的读写操作
  - 在NameNode的调度下对数据块进行创建、存储、删除、备份等操作。 

## ZooKeeper
ZooKeeper是一个分布式的，开放源码的分布式应用程序协调服务，是Google的Chubby一个开源的实现，它是集群的管理者，监视着集群中各个节点的状态根据节点提交的反馈进行下一步合理操作。最终，将简单易用的接口和性能高效、功能稳定的系统提供给用户。

它用于管理大型主机。ZooKeeper 的设计目标是将那些复杂且容易出错的分布式一致性服务封装起来，构成一个高效可靠的原语集。在分布式环境中协调和管理服务是一个复杂的过程，而ZooKeeper通过其简单的架构和API解决了这个问题，例如ZK提供了数据发布订阅、负载均衡、命名服务、Master选举、集群管理、配置管理、分布式队列和分布式锁等功能。

zookeeper提供了
1. 文件系统,管理（存储、读取）用户程序提交的数据
2. 通知机制,为用户程序提交数据节点监听服务。

特点总结：
1. 集群部署，容错性高。
   ZooKeeper 本身就是一个分布式程序（只要半数以上节点存活，ZooKeeper 就能正常服务）。
2. 内存设计，高吞吐低延迟。
3. 特别适合读场景，性能好。
4. 临时节点设计，提供监听服务。

## Hbase Hadoop数据库
HBase是一种Hadoop数据库，经常被描述为一种稀疏的，分布式的，持久化的，多维有序映射，它基于行键、列键和时间戳建立索引，是一个可以随机访问的存储和检索数据的平台。HBase不限制存储的数据的种类，允许动态的、灵活的数据模型，不用SQL语言，也不强调数据之间的关系。HBase被设计成在一个服务器集群上运行，可以相应地横向扩展。